{"ast":null,"code":"var _jsxFileName = \"/Users/anoukpaap/Desktop/opdracht-novi/src/context/AuthContext.js\",\n    _s = $RefreshSig$();\n\nimport React, { createContext, useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport jwt_decode from 'jwt-decode';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext({});\n\nfunction AuthContextProvider(_ref) {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [auth, toggleAuth] = useState({\n    isAuth: false,\n    user: null,\n    status: 'pending'\n  });\n  const history = useHistory();\n  useEffect(() => {\n    // is er een token?\n    const token = localStorage.getItem('token'); // En zo ja, is deze nog geldig? (zelf nog functie invoegen)\n\n    if (token) {\n      // ZO JA: haal opnieuw de gebruikersdata op en zet deze in de state\n      async function getUserData() {\n        // we decoden de token\n        const decodedToken = jwt_decode(token);\n\n        try {\n          const response = await axios.get(`https://frontend-educational-backend.herokuapp.com//${decodedToken.sub}`, {\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: `Bearer ${token}`\n            }\n          }); // We setten de state met de gegevens\n\n          toggleAuth({\n            isAuth: true,\n            user: {\n              email: response.data.email,\n              username: response.data.username,\n              id: response.data.id\n            },\n            status: 'done'\n          });\n        } catch (e) {\n          toggleAuth({ ...auth,\n            status: 'error'\n          }); // voor de zekerheid de eventuele token uit de localStorage halen!\n\n          localStorage.clear();\n          console.error(e);\n        }\n      }\n\n      getUserData();\n    } else {\n      // ZO NEE: doe verder niks en ga verder met je leven\n      toggleAuth({ ...auth,\n        status: 'done'\n      });\n    }\n  }, []);\n\n  function login(token) {\n    // decode de token om te kijken wanneer hij verloopt en welke info erin zit\n    const decodedToken = jwt_decode(token);\n    console.log(decodedToken); // 1. Zet de token in de localStorage\n\n    localStorage.setItem('token', token); // 2. Haal, indien nodig, de gebruikersgegevens uit de backend op:\n    // async function getData() {\n    // };\n    // 3. Zet de gebruikersgegevens (MAAR NIET DE JWT) in de context state:\n\n    toggleAuth({ ...auth,\n      isAuth: true,\n      user: {\n        email: decodedToken.email,\n        id: decodedToken.sub\n      },\n      status: 'done'\n    });\n    console.log('De gebruiker is ingelogd!');\n    history.push('/profile');\n  }\n\n  function logout() {\n    console.log('De gebruiker is uitgelogd!');\n    toggleAuth({\n      isAuth: false,\n      user: null,\n      status: 'done'\n    });\n    history.push('/');\n  }\n\n  const contextData = {\n    isAuth: auth.isAuth,\n    user: auth.user,\n    login: login,\n    logout: logout\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: [auth.status === 'done' && children, auth.status === 'pending' && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 43\n    }, this), auth.status === 'error' && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Error! Refresh de pagina!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 41\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 9\n  }, this);\n}\n\n_s(AuthContextProvider, \"yJe/53vL+1QP87Cq8MYclcLS/XA=\", false, function () {\n  return [useHistory];\n});\n\n_c = AuthContextProvider;\nexport default AuthContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useState","useHistory","jwt_decode","axios","AuthContext","AuthContextProvider","children","auth","toggleAuth","isAuth","user","status","history","token","localStorage","getItem","getUserData","decodedToken","response","get","sub","headers","Authorization","email","data","username","id","e","clear","console","error","login","log","setItem","push","logout","contextData"],"sources":["/Users/anoukpaap/Desktop/opdracht-novi/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport jwt_decode from 'jwt-decode';\nimport axios from 'axios';\n\nexport const AuthContext = createContext({});\n\nfunction AuthContextProvider({ children }) {\n    const [auth, toggleAuth] = useState({\n        isAuth: false,\n        user: null,\n        status: 'pending',\n    });\n\n    const history = useHistory();\n\n    useEffect(() => {\n        // is er een token?\n        const token = localStorage.getItem('token');\n\n        // En zo ja, is deze nog geldig? (zelf nog functie invoegen)\n        if (token) {\n            // ZO JA: haal opnieuw de gebruikersdata op en zet deze in de state\n            async function getUserData() {\n                // we decoden de token\n                const decodedToken = jwt_decode(token);\n\n                try {\n                    const response = await axios.get(`https://frontend-educational-backend.herokuapp.com//${decodedToken.sub}`, {\n                        headers: {\n                            \"Content-Type\": \"application/json\",\n                            Authorization: `Bearer ${token}`,\n                        }\n                    });\n\n                    // We setten de state met de gegevens\n                    toggleAuth({\n                        isAuth: true,\n                        user: {\n                            email: response.data.email,\n                            username: response.data.username,\n                            id: response.data.id,\n                        },\n                        status: 'done',\n                    })\n                } catch(e) {\n                    toggleAuth({\n                        ...auth,\n                        status: 'error',\n                    });\n                    // voor de zekerheid de eventuele token uit de localStorage halen!\n                    localStorage.clear();\n                    console.error(e);\n                }\n            }\n\n            getUserData();\n        } else {\n            // ZO NEE: doe verder niks en ga verder met je leven\n            toggleAuth({\n                ...auth,\n                status: 'done',\n            });\n        }\n    }, []);\n\n    function login(token) {\n        // decode de token om te kijken wanneer hij verloopt en welke info erin zit\n        const decodedToken = jwt_decode(token);\n        console.log(decodedToken);\n\n        // 1. Zet de token in de localStorage\n        localStorage.setItem('token', token);\n        // 2. Haal, indien nodig, de gebruikersgegevens uit de backend op:\n        // async function getData() {\n        // };\n\n        // 3. Zet de gebruikersgegevens (MAAR NIET DE JWT) in de context state:\n        toggleAuth({\n            ...auth,\n            isAuth: true,\n            user: {\n                email: decodedToken.email,\n                id: decodedToken.sub,\n            },\n            status: 'done',\n        });\n\n        console.log('De gebruiker is ingelogd!');\n        history.push('/profile');\n    }\n\n    function logout() {\n        console.log('De gebruiker is uitgelogd!');\n        toggleAuth({\n            isAuth: false,\n            user: null,\n            status: 'done',\n        });\n\n        history.push('/');\n    }\n\n    const contextData = {\n        isAuth: auth.isAuth,\n        user: auth.user,\n        login: login,\n        logout: logout,\n    };\n\n    return (\n        <AuthContext.Provider value={contextData}>\n            {/*{auth.status === 'done' ? children : <p>Loading...</p>}*/}\n            {auth.status === 'done' && children}\n            {auth.status === 'pending' && <p>Loading...</p>}\n            {auth.status === 'error' && <p>Error! Refresh de pagina!</p>}\n        </AuthContext.Provider>\n    );\n}\n\nexport default AuthContextProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module"}