{"ast":null,"code":"import _regeneratorRuntime from\"/Users/anoukpaap/Desktop/opdracht-novi/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/anoukpaap/Desktop/opdracht-novi/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/anoukpaap/Desktop/opdracht-novi/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/anoukpaap/Desktop/opdracht-novi/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{createContext,useState,useEffect}from'react';import{useHistory}from'react-router-dom';import jwt_decode from'jwt-decode';import axios from'axios';import isTokenValid from\"../Helpers/isTokenValid\";import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext({});function AuthContextProvider(_ref){var children=_ref.children;var _useState=useState({isAuth:false,user:null,status:'pending'}),_useState2=_slicedToArray(_useState,2),isAuth=_useState2[0],toggleIsAuth=_useState2[1];var history=useHistory();useEffect(function(){var token=localStorage.getItem('token');if(token&&isTokenValid()){var decoded=jwt_decode(token);fetchUserData(decoded.sub,token);}else{toggleIsAuth({isAuth:false,user:null,status:'done'});}},[]);function login(JWT){localStorage.setItem('token',JWT);var decoded=jwt_decode(JWT);fetchUserData(decoded.sub,JWT,'/dashboard');}function logout(){localStorage.clear();toggleIsAuth({isAuth:false,user:null,status:'done'});console.log('Gebruiker is uitgelogd!');history.push('/inlog');}function fetchUserData(_x,_x2,_x3){return _fetchUserData.apply(this,arguments);}function _fetchUserData(){_fetchUserData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(id,token,redirectUrl){var result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.post(\"https://frontend-educational-backend.herokuapp.com/api/auth/signin\",{headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)}});case 3:result=_context.sent;toggleIsAuth(_objectSpread(_objectSpread({},isAuth),{},{isAuth:true,user:{username:result.data.username,email:result.data.email,id:result.data.id},status:'done'}));// als er een redirect URL is meegegeven (bij het mount-effect doen we dit niet) linken we hiernnaartoe door\n// als we de history.push in de login-functie zouden zetten, linken we al door voor de gebuiker is opgehaald!\nif(redirectUrl){history.push(redirectUrl);}_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(_context.t0);toggleIsAuth({isAuth:false,user:null,status:'done'});case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return _fetchUserData.apply(this,arguments);}var contextData={isAuth:isAuth.isAuth,user:isAuth.user,login:login,logout:logout};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:isAuth.status==='done'?children:/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"})});}export default AuthContextProvider;","map":{"version":3,"names":["React","createContext","useState","useEffect","useHistory","jwt_decode","axios","isTokenValid","AuthContext","AuthContextProvider","children","isAuth","user","status","toggleIsAuth","history","token","localStorage","getItem","decoded","fetchUserData","sub","login","JWT","setItem","logout","clear","console","log","push","id","redirectUrl","post","headers","Authorization","result","username","data","email","error","contextData"],"sources":["/Users/anoukpaap/Desktop/opdracht-novi/src/context/AuthContext.js"],"sourcesContent":["\nimport React, { createContext, useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport jwt_decode from 'jwt-decode';\nimport axios from 'axios';\nimport isTokenValid from \"../Helpers/isTokenValid\";\n\n\nexport const AuthContext = createContext({});\n\nfunction AuthContextProvider({ children }) {\n    const [isAuth, toggleIsAuth] = useState({\n        isAuth: false,\n        user: null,\n        status: 'pending',\n    });\n\n    const history = useHistory();\n\n    useEffect(() => {\n        const token = localStorage.getItem('token');\n        if (token && isTokenValid()) {\n            const decoded = jwt_decode(token);\n            fetchUserData(decoded.sub, token);\n        } else {\n            toggleIsAuth({\n                isAuth: false,\n                user: null,\n                status: 'done',\n            });\n        }\n    }, []);\n\n\n    function login(JWT) {\n        localStorage.setItem('token', JWT);\n        const decoded = jwt_decode(JWT);\n        fetchUserData(decoded.sub, JWT, '/dashboard');\n\n    }\n\n\n    function logout() {\n        localStorage.clear();\n        toggleIsAuth({\n            isAuth: false,\n            user: null,\n            status: 'done',\n        });\n\n        console.log('Gebruiker is uitgelogd!');\n        history.push('/inlog');\n    }\n\n    async function fetchUserData(id, token, redirectUrl) {\n        try {\n\n            const result = await axios.post(`https://frontend-educational-backend.herokuapp.com/api/auth/signin`, {\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Authorization: `Bearer ${token}`,\n                },\n            });\n\n            toggleIsAuth({\n                ...isAuth,\n                isAuth: true,\n                user: {\n                    username: result.data.username,\n                    email: result.data.email,\n                    id: result.data.id,\n                },\n                status: 'done',\n            });\n\n            // als er een redirect URL is meegegeven (bij het mount-effect doen we dit niet) linken we hiernnaartoe door\n            // als we de history.push in de login-functie zouden zetten, linken we al door voor de gebuiker is opgehaald!\n            if (redirectUrl) {\n                history.push(redirectUrl);\n            }\n\n        } catch (e) {\n            console.error(e);\n            toggleIsAuth({\n                isAuth: false,\n                user: null,\n                status: 'done',\n            });\n        }\n    }\n\n    const contextData = {\n        isAuth: isAuth.isAuth,\n        user: isAuth.user,\n        login: login,\n        logout: logout,\n    };\n\n\n    return (\n        <AuthContext.Provider value={contextData}>\n            {isAuth.status === 'done' ? children : <p>Loading...</p>}\n        </AuthContext.Provider>\n    );\n}\n\nexport default AuthContextProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module"}